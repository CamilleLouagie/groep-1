\documentclass[a4paper,kulak]{kulakarticle}

\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage{pgfplots}
\pgfplotsset{width=15cm,compat=1.7}  
\usepackage[dutch]{babel}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{siunitx}
\usepackage[toc,page]{appendix}
\renewcommand\appendixname{Appendices}
\renewcommand\appendixpagename{Appendices}
\usepackage{pdfpages}
\usepackage{subcaption}
\usepackage{mwe}
\renewcommand{\arraystretch}{2}
\usepackage{listings}

\title{Eindverslag}
\author{Groep 1: Safety First}
\address{
	Ruben Leenknecht, Emiel Vanspranghels, \\
	 Otto Meerschman, Staf Rys, Camille Louagie}
\date{vrijdag 21 mei, 2021}

\begin{document}

\maketitle
\tableofcontents

\newpage

\section{Inleiding}

\textbf{\large De groei en het verval van steden} \\
Meer en meer zien we een groei van het verstedelijkt gebied. Met deze groei nemen ook de problemen toe, zoals onder meer criminaliteit \cite{crimi}, lawaai \cite{lawaai} en milieuvervuiling \cite{milieu}. Als we terugkijken in de tijd, zien we een meermaals voorkomende situatie. Steden zitten in een bloeiperiode, bereiken een verzadingspunt en kunnen daarna de vraag niet meer aan. Dit heeft een negatief effect op de economie en de efficiëntie in een stad. Zo was er ook de val van Rome, nadat deze een hoogtepunt had bereikt. Oude steden hadden dan wel een kleiner bereik, maar de relatie tussen technologie en stedelijke groei blijft dezelfde \cite{smartcities} . We staan opnieuw voor een keerpunt, waarbij we moeten kiezen tussen groeien of blijven steken.

We moeten de technologie die we voor handen hebben kunnen gebruiken om dit vastlopen te voorkomen. Met andere woorden moeten we van onze steden zogezegde  \lq slimme steden\rq\  maken \cite{taaladvies}. In ons dagdagelijkse leven worden we geconfronteerd met inefficiënte situaties die opgelost kunnen worden door een \lq slimme\rq\ aanpak. Daarom is het nodig mensen bewust te maken van het nut van deze slimme steden.\\ \\
\textbf{\large Slimme steden} \\
Maar wat zijn slimme steden nu juist? Met slim wordt de technologische innovatie bedoeld die opweegt tegen fysieke beperkingen. Een stad is een gebied van interacties en bijgevolg ook problemen en confrontaties \cite{sc}. In een kleine ruimte worden verscheidene zaken geconcentreerd samengebracht. Een stad heeft een veelheid aan functies en is pas doelmatig  wanneer ze deze functies met succes volbrengt \cite{synoniemen}. Een slimme stad wordt bereikt door stedelijke werking efficiënt te laten verlopen en door het vereenvoudigen van (openbare) diensten. Informatie- en communicatietechnologie (ICT) wordt gecombineerd met dagdagelijkse objecten om die interacties te verbeteren en stedelijke problemen te verminderen. Ondanks de vele vooruitgang van de afgelopen jaren, is het idee van een stad die volledig voorgeprogrammeerd gestuurd wordt, zonder menselijke tussenkomsten, voorlopig nog steeds een utopie. Nieuwe mogelijkheden en doorbraken zijn een drijfveer opdat dit ooit realiteit wordt \cite{proconsc}.\\ \\
\textbf{\large Zelfrijdende auto's} \\
Een van de middelen om de efficiëntie te verhogen in een stad is door het invoeren van zelfrijdende auto's die zelfstandig kunnen deelnemen aan het verkeer. Niet alleen wordt er extra tijd gecreëerd voor de bestuurder, die deze tijd dan nuttiger kan spenderen, maar ook kunnen de auto's dichter op elkaar volgen en is het naleven van de verkeersregels verzekerd, mits de regels correct geïnterpreteerd worden. Dit kan ook voor een vermindering van het aantal verkeersongevallen zorgen en bijgevolg minder filedrukte. Het concept heeft niet alleen maar voordelen. Zo zouden hackers kunnen zorgen voor enorme verkeersproblemen. De verkeersongevallen die zich voordoen veroorzaken juridische conflicten in verband met aansprakelijkheid. Wie is verantwoordelijk wanneer iets misloopt? Is dit de bestuurder, de constructeur of de softwareontwikkelaar? Ook een inkomst van de overheid valt weg wanneer geen verkeersboetes worden betaald. Daardoor zullen er meer belastingen op elektriciteit moeten geheven worden. Daarnaast zullen verschillende beroepen zoals buschauffeurs, rijinstructeurs en vrachtwagenchauffeurs overbodig worden, wat voor meer werkeloosheid onder minder geschoolden zal leiden \cite{procontracars}.

Ondanks het feit dat de Vlaamse overheid autonoom rijden stimuleert met projecten zoals Smart Highway en project CONCORDA, staat men in Vlaanderen sceptisch tegenover het idee \cite{vbn}. Zo zou er een te grote psychologische drempel zijn \cite{scept}. Toch is er sprake van een grote marktpotentie. Bij de nieuwste auto's is er al sprake van een zekere mate van zelfstandigheid, zo kan men gealarmeerd worden bij het naderen van een andere bestuurder of een volle witte lijn. Bekende bedrijven zoals Google, Apple en Uber zijn volop bezig met de ontwikkeling van deze autonome wagens. Google werkt samen met verschillende autobouwers, waaronder Audi en Toyota. Apple heeft met hun project \lq Titan\rq\ al meer dan 50 autonome wagens op de openbare weg rijden \cite{bedrijven}. Er is geen ontkennen aan, zelfrijdende auto's hebben een toekomst. Om deze reden hebben wij besloten een miniatuurwagen te maken die in staat is om autonoom een voorgeprogrammeerde weg te volgen. Deze wagen laten we rijden in een miniatuur \lq \textit{smart city}\rq\ samen met andere wagentjes met hetzelfde doel: het parcours met succes beëindigen. De taak is volbracht als het wagentje de verkeersregels volgt, het parcours juist interpreteert en geen botsingen veroorzaakt. We maken van de gekregen vrijheid gebruik om het wagentje volledig naar onze hand te zetten.

\section{Klantenvereisten en ontwerpspecificaties}
Een zelfrijdende miniatuurwagen die zich rondbeweegt in een slimme stad zal aan bepaalde vereisten moeten voldoen en bepaalde dingen moeten kunnen om zich zonder problemen te kunnen voortbewegen. Deze vereisten hangen vast aan hoe de slimme stad er uitziet en wat er van de gebruikers verwacht wordt


\subsection{Klantenvereisten}
De miniatuurwagen moet zich volgens een voorgeprogrammeerde route door een modelstad kunnen voortbewegen waarbij de modelstad bestaat uit negen identieke kruispunten, verbonden door straten van één meter lang, waar de wagen al dan niet mag doorrijden of afslaan. Ook moet de miniatuurwagen een voorligger of obstakel kunnen detecteren terwijl hij rijdt over een baan. Hierbij volgt de miniatuurwagen een zwarte, volle volglijn. Bij de kruispunten is er een stopstreep en hangen er stoplichten op 75 mm hoogte, die gemonteerd zijn op een tafelonderstel van 300 mm hoog. De miniatuurwagen moet stoppen bij de stopstreep en kunnen interpreteren wanneer hij mag doorrijden en op tijd kunnen stoppen om een botsing te vermijden indien nodig. Ook moet er een grafische gebruikersomgeving zijn waarmee relevante gegevens van de miniatuurwagen kunnen afgelezen worden en een manuele overname kan uitgevoerd worden. De manuele overname moet in staat zijn een noodstop uit te voeren of de besturing van de miniatuurwagen over te nemen. De maximale kostprijs van de zelfrijdende miniatuurwagen mag niet meer dan 3500 virtuele eenheden zijn.

\subsection{Ontwerpspecificaties}
De afmetingen van de miniatuurwagen worden beperkt tot 300 mm in de hoogte door de tafelonderstellen bij de kruispunten en 250 mm breedte door de breedte van de baan. De lengte van de miniatuurwagen valt vrij te kiezen, maar het moet wel haalbaar zijn om bijvoorbeeld bochten te nemen. De miniatuurwagen volgt een donkere volglijn van 25 mm breed op een lichte ondergrond. Aan een kruispunt interpreteert het wagentje een verkeerslicht dat zich bevindt op 75 mm boven de grond en knippert aan een frequentie van één Hertz. Het verkeerslicht is gemonteerd aan de voorkant van een tafelpoot waardoor het wagentje hem langs de rechterkant zal moeten detecteren.  Indien het verkeerslicht rood is, stopt de miniatuurwagen bij de stopstreep. Deze stopstreep is 50 mm dik en 25 cm lang. Het miniatuurwagentje kan ook voorliggers detecteren via een afstandssensor. Indien het een voorligger detecteert, vertraagt het wagentje of stopt het om zo een botsing te
vermijden. Het te volgen traject wordt een week op voorhand bekend gemaakt en kan
dan geprogrammeerd worden. De componenten van het prototype mogen verbonden worden via een experimenteerbord. De definitieve versie van de miniatuurwagen moet wel via een printplaat kunnen functioneren. Voor de microcontroller dient gebruik te worden
gemaakt van een NI myRIO of Raspberry Pi. Tussen de microcontroller en de motoren dient een motorshield te worden aangebracht, gezien dit een terugloopbeveiliging
bevat die beschadiging van de microcontroller voorkomt. Er moet ook een draadloze informatieoverdracht via UDP naar LabVIEW aanwezig zijn, die geïmplementeerd zal worden als een zelfgemaakte grafische gebruikersomgeving. 


\section{Ontwerp}

\subsection{Algemene opbouw}
De ontwerpruimte werd sterk beperkt door de gelimiteerde materiaaldatabank. De belangrijkste keuzes betroffen de wielen, de motor, de microcontroller, het chassis, het type sensoren, de powerbank en het experimenteerbord. Het bouwproces is te zien in figuur \ref{fig:deelfiguren}.
\\\\ \textbf{\large De wielen} \\
Voor de wielen van de miniatuurwagen hebben we gekozen voor de kleinste wielen met een diameter van 32 mm. Het voordeel aan deze wielen is dat ze meer nauwkeurigheid bieden bij het roteren van de miniatuurwagen en minder kracht nodig hebben om rond gedraaid te worden. Daarnaast kunnen kleinere wielen ook sneller ronddraaien, waardoor de elektrische motoren die de wielen aandrijven ook sneller ronddraaien. Dit leidt tot een verhoogde efficiëntie. Het nadeel aan deze wielen is echter wel dat de topsnelheid lager ligt. De wielen komen aan de voorkant, zoals te zien op figuur \ref{fig:Onderkant}, zodat dit het besturen van de miniatuurwagen vergemakkelijkt. De kogelrol zullen we in het midden van de achterkant plaatsen. Deze zullen we op eenzelfde hoogte plaatsen als de wielen door er plastic plaatjes onder te bevestigen. We positioneren de kogelrol zodanig dat het chassis een minimale hoek maakt met de grond. Op deze manier verzekeren we dat de lijnsensor en de afstandssensor respectievelijk parallel en loodrecht staat met het grondoppervlak. De keuze voor deze wielen legt ook beperkingen op aan het type motoren.\\ \\
\\
\textbf{\large De motor}
\\
\begin{table}
	\centering
	
	\begin{tabular}{|l|r|r|r|}\hline
		  \textbf{Motor}&	\textbf{toeren/min} &	\textbf{km/h}	\\\hline
		100:1 HP&	310&	0.78\\\hline
		100:1&	130&	1.87 	\\\hline
		50:1 HP&	590&	2.71 \\\hline
		30:1&	450&	3.56	\\\hline
		30:1 HP&	1000&	6.03 	\\\hline
	\end{tabular}
	\caption{Berekening snelheid voor elke motor voor wielen met diameter 32 mm}\label{MotorenTab}

\end{table}
Wij kozen voor de 30:1 HP motor aangezien deze met een snelheid van ca. zes km per uur het meest compatibel zijn met de gekozen wielen. Deze motor zorgt voor de hoogste topsnelheid met de wielen die we gekozen hadden. Om dit te bepalen hebben we enkele berekeningen uitgevoerd met het aantal toeren per minuut dat de motor maximaal kan draaien en de omtrek van de wielen \cite{converter}. Deze resultaten zijn te vinden in tabel \ref{MotorenTab}. Na een testrit bleken de motoren te snel voor onze wagen, het koppel was te laag. Dit heeft ons doen kiezen voor motoren met meer koppel, namelijk de 100:1 motoren. Deze wielen en motoren zullen we plaatsen aan de voorkant van onze wagen. De motoren worden aan de onderkant van het chassis bevestigd om zo ons chassis hoger van de grond te krijgen en zo kan op die manier ook de lijnsensor aan de onderkant van het chassis geplaatst worden. Dit alles is te zien op figuur \ref{fig:Onderkant}.

\begin{figure} [h]
	\begin{tikzpicture}
		\node [anchor=west] (Lijnsensor) at (-2,6) {\Large Lijnsensor};
		\node [anchor=west] (Wielen) at (-2,4) {\Large Wielen};
		\node [anchor=west] (Kogelrol) at (-2,1.5) {\Large Kogelrol};
		\begin{scope}[xshift=1.5cm]
			\node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=.5\textwidth] {onderkant}
				
			};
			\begin{scope}[x={(image.south east)},y={(image.north west)}]
				%\draw[cyan,ultra thick,rounded corners] (0.4,0.55) rectangle (0.2,0.3);
				\draw [-stealth, line width=3pt, cyan] (Lijnsensor) -- ++(0.6,0.0);
				%\draw[cyan,ultra thick,rounded corners] (0.4,0.55) rectangle (0.2,0.3);
				\draw [-stealth, line width=3pt, cyan] (Wielen) -- ++(0.45,0.0);
				\draw [-stealth, line width=3pt, cyan] (Kogelrol) -- ++(0.75,0.0);
			\end{scope}
			
		\end{scope}
	\end{tikzpicture}
	
	\caption{De lijnsensor is bevestigd tussen de wielen, aan de onderkant van de wagen. Dit zorgt ervoor dat het wagentje nauwkeurig rijdt en snel correcties kan uitvoeren. De figuur toont de onderkant van de wagen.}\label{fig:Onderkant}
\end{figure}


\begin{figure*}
	\centering
	\begin{subfigure}[b]{0.475\textwidth}
		\centering
		\includegraphics[width=\textwidth]{1.PNG}
		\caption[Network2]%
		{{\small Het zelfontworpen chassis}}    
		\label{fig:a}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.475\textwidth}  
		\centering 
		\includegraphics[width=\textwidth]{2.png}
		\caption[]%
		{{\small Figuur \ref{fig:a} met wielen en motoren}}    
		\label{fig:b}
	\end{subfigure}
	\vskip\baselineskip
	\begin{subfigure}[b]{0.475\textwidth}   
		\centering 
		\includegraphics[width=\textwidth]{3.PNG}
		\caption[]%
		{{\small Figuur \ref{fig:b} met de microcontroller, Raspberry Pi}}    
		\label{fig:c}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.475\textwidth}   
		\centering 
		\includegraphics[width=\textwidth]{4.PNG}
		\caption[]%
		{{\small Figuur \ref{fig:c} met de powerbank en het experimenteerbord }}    
		\label{fig:d}
	\end{subfigure}
	\vskip\baselineskip
	\begin{subfigure}[b]{0.475\textwidth}   
		\centering 
		\includegraphics[width=\textwidth]{5.PNG}
		\caption[]%
		{{\small Figuur \ref{fig:d} met de MakerBeam-constructie}}    
		\label{fig:e}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.475\textwidth}   
		\centering 
		\includegraphics[width=\textwidth]{6.PNG}
		\caption[]%
		{{\small Figuur \ref{fig:e} met de sensoren: kleurensensor, afstandssensor en lijnsensor}}    
		\label{fig:f}
	\end{subfigure}
	\caption
	{\small De deelfiguren tonen het bouwproces van de miniatuurwagen stap voor stap.} 
	\label{fig:deelfiguren}
\end{figure*}



\noindent\textbf{\large De microcontroller}\
\\
Een Raspberry Pi verbruikt zeer weinig stroom, wat een groot voordeel is wanneer je miniatuurwagentje op een batterij werkt. Daarnaast is het zeer makkelijk om informatie over de werking te vinden, aangezien deze microcontroller zoveel gebruikt wordt \cite{rasp}.
De Raspberry Pi wordt geplaatst op vier afstandsbussen van 15 mm hoog waardoor hij op een platform komt te staan. Dit is te zien op figuur \ref{fig:afbchassis}. Op deze manier voorzien we voldoende ruimte voor de (plaatsing van de) sensoren, motoren, wielen en Maker Beams die nog op het chassis moeten komen. \\ Op de Raspberry Pi komen twee kleine experimenteerborden die aan elkaar gelinkt zijn. Achter de Raspberry Pi ter hoogte van onze kogelrol zullen we de powerbank op het chassis plaatsen. Deze past juist niet onder de Raspberry waardoor hij niet onder het platform kan. De powerbank zorgt met zijn gewicht ervoor dat het massamiddelpunt van de wagen meer naar achteren en lager komt te liggen wat zorgt voor extra stabiliteit. De powerbank is ook makkelijk aan te sluiten op de Raspberry Pi en levert het juiste voltage voor de Raspberry Pi om te functioneren. 

\begin{figure} [h]
	\begin{tikzpicture}
		\node [anchor=west] (Powerbank) at (-2,4) {\Large Powerbank};
		\node [anchor=west] (Afstandssensor) at (-2,1) {\Large Afstandssensor};
		\node [anchor=west] (Microcontroller) at (-2,3) {\Large Microcontroller};
		\begin{scope}[xshift=1.5cm]
			\node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.5\textwidth]{6.PNG}
				
			};
			\begin{scope}[x={(image.south east)},y={(image.north west)}]
				%\draw[cyan,ultra thick,rounded corners] (0.4,0.55) rectangle (0.2,0.3);
				\draw [-stealth, line width=3pt, cyan] (Powerbank) -- ++(01.1,0.0);
				%\draw[cyan,ultra thick,rounded corners] (0.4,0.55) rectangle (0.2,0.3);
				\draw [-stealth, line width=3pt, cyan] (Afstandssensor) -- ++(0.43,0.1);
				\draw [-stealth, line width=3pt, cyan] (Microcontroller) -- ++(0.45,0.0);
			\end{scope}
			
		\end{scope}
	\end{tikzpicture}


	
	\caption{De volledige miniatuurwagen}\label{fig:afbchassis}
\end{figure}


\noindent\textbf{\large Het chassis} \\
Het chassis is handmatig ontworpen naar de behoeften van het miniatuurwagentje en zal ge-3D-print worden. Door het chassis zelf te ontwerpen, kunnen we van het standaard model afstappen en ons wagentje er laten uitspringen. Dit chassis zal 140 mm lang, 110 mm breed en 3 mm dik zijn met afgeronde hoeken, zoals te zien op figuur \ref{fig:chassis}. Hiermee bekomen we een chassis waarmee we genoeg ruimte hebben in de lengte om onze microcontroller en onze powerbank op te plaatsen. Vooraan het chassis zal er een gleuf voorzien worden van 6,5 mm breed en 45,8 mm lang voor de verbindingsdraden naar de lijnsensor die onder het chassis hangt, zie figuur \ref{fig:Onderkant}. Er zullen zich ook gaten in het chassis bevinden die kunnen gebruikt worden voor het bevestigen van componenten met schroeven en moeren. Het chassis zal aan een dichtheid van 70\% ge-3D-print worden zodat het genoeg steun kan bieden.

\begin{figure}[h]
	\centering
	\includegraphics[width=.4\textwidth] {chascad}
	\caption{CAD-model van het zelf-ontworpen chassis.}
	\label{fig:chassis}
\end{figure}

\subsection{Sensoren}
\textbf{\large De kleurensensor} \\
De kleurensensor zal bevestigd worden aan een MakerBeam-staaf op een hoogte van 75 mm van de grond zodat deze het verkeerslicht, die op dezelfde hoogte hangt, kan detecteren. Deze constructie laat toe om de positie van de kleurensensor eenvoudig (en handmatig) bij te stellen, dit is te zien op figuur \ref{fig:Linksaanzicht}. Deze constructie bestaat uit een MakerBeam die horizontaal in het midden van ons chassis ligt onder de Raspberry Pi met daarop een MakerBeam verticaal omhoog aan het rechter uiteinde. De kleurensensor wordt bevestigd aan de horizontale MakerBeam. \\ \\
\\ \\
\

\begin{figure}[h]
	\begin{tikzpicture}
		\node [anchor=west] (Afstandsbussen) at (-2,2) {\Large Afstandsbussen};
		\node [anchor=west] (Kleurensensor) at (-2,5) {\Large Kleurensensor};
		\node [anchor=west] (Afstand) at (11,2.5) {\Large 75 mm};
		\node[inner sep=0pt] (verkeerslicht) at (10,5)
		{\includegraphics[width=.1\textwidth]{verkeerslicht_image.png}};
		\begin{scope}[xshift=1.5cm]
			\node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=.5\textwidth] {rechterkant}
				
			};
			\begin{scope}[x={(image.south east)},y={(image.north west)}]
				%\draw[cyan,ultra thick,rounded corners] (0.4,0.55) rectangle (0.2,0.3);
				\draw [-stealth, line width=3pt, cyan] (Afstandsbussen) -- ++(0.55,0.0);
				\draw [-stealth, line width=3pt, cyan] (Kleurensensor) -- ++(0.75,0.0);
			\end{scope}
			\draw[thick,->] (8.5,4.5) -- (8.5,0.5);
			\draw[thick,->] (8.5,0.5) -- (8.5,4.5);
		\end{scope}
	\end{tikzpicture}
	
	\caption{De kleurensensor wordt bevestigd aan een MakerBeam-constructie die toelaat om de sensor optimaal te positioneren. De figuur toont het linkeraanzicht van het wagentje.}\label{fig:Linksaanzicht}
\end{figure}


\noindent\textbf{\large De afstandssensor} \
\\
Voor de afstandssensor hebben we gekozen voor een analoge sensor, opdat we nauwkeurig kunnen meten hoever het wagentje verwijderd is van een obstakel of een andere weggebruiker. Doordat we dit onderscheid kunnen maken moet onze miniatuurwagen niet direct stoppen wanneer hij een voorligger detecteert, maar kan hij er voor  zorgen dat hij eerst wat trager rijdt vooraleer volledig te stoppen. De afstandssensor wordt aan de voorzijde van het chassis bevestigd met behulp van een MakerBeam.\\ \\
\\
\textbf{\large De lijnsensor} \
\\
De lijnsensor wordt gebruikt om de volglijn te detecteren. Hierbij hebben we een digitale sensor gekozen omdat deze compatibel is met de Raspberry Pi microcontroller en de sensor geen onderscheid moet kunnen maken tussen verschillende lijnsoorten. Deze wordt aan de voorkant onder het chassis bevestigd met behulp van afstandsbuizen zodat deze de volglijn als eerst detecteert en we zo sneller correcties kunnen uitvoeren. Aangezien de sensor dicht bij de wielen hangt, zal het wagentje ook nauwkeuriger bewegen.

Het volledige ontwerp met de lijnsensor is te zien in figuur \ref{fig:afbchassis}.

\section{Software}

\textbf{\large De manuele overname} \\
De manuele overname is als volgt geïmplementeerd: De LabVIEW-code loopt continu op een pc terwijl de Python-code dat ook doet op de Raspberry Pi. Wanneer de overnameknop wordt ingedrukt, wordt de overname ingeschakeld. Het programma komt in een lus terecht en controleert de berichten die binnenkomen. Afhankelijk van de binnenkomende berichten gaat het wagentje vooruit, achteruit, naar links of naar rechts. Indien er met behulp van de overname kruispunten genomen worden, kan men handmatig bij het stopcommando het huidige kruispuntnummer meegeven. Dit is optioneel, dus als er geen nummer wordt meegegeven, wordt het kruispuntnummer niet gewijzigd. Indien men op geen enkele knop drukt blijft de overname actief, maar worden de motoren niet aangedreven. Indien men op de stopknop drukt, wordt de overname afgesloten tot het eventueel terug wordt opgestart. \\ \\
\\
\textbf{\large De lijnsensor}\
\\
Bij de lijnsensor wordt eerst de ruwe data van de acht sensoren ingelezen. Deze data wordt uitgedrukt in seconden. Bij weinig reflectie (een donker oppervlak) zijn deze waarden hoog, bij veel reflectie (een wit oppervlak) zijn deze waarden laag. 

Omdat deze data niet praktisch is om mee te werken, wordt deze herschaald tot een waarde van 0 tot 1000, waarbij lagere waarden voor lichtere oppervlakken staan. Dit gebeurt aan de hand van een gekalibreerde minimum- en maximumwaarde van de seconden. Deze twee waarden worden op voorhand bepaald door de robotwagen over de lichte vloer te laten rijden en vervolgens over de zwarte volglijn, waarbij het minimum en maximum van de uitgelezen data genomen wordt. 
Nadat de data herschaald is, definiëren we de positie van het voertuig met volgende formule:
\begin{equation*}
	\frac{0\cdot waarde_{0} + 1000\cdot waarde_{1}+ ...+ 7000\cdot waarde_{7}} {waarde_{0} + waarde_{1} + ... + waarde_{7}}
\end{equation*}

Hierbij staat $waarde_{0} $voor de herschaalde waarde van de eerste, meest linkse sensor en $waarde_{7}$ voor de herschaalde waarde van de meest rechtse sensor. De breedte van de lijn is 25 mm, wat ongeveer overeenkomt met twee sensoren die een zwart oppervlak zien, terwijl de overige zes sensoren zich boven het lichte oppervlak bevinden. Aangezien we zouden willen dat de lijn zich onder het midden van de robotwagen bevindt, zouden we graag $waarde_{3}$ en $waarde_{4}$ gelijk hebben aan 1000 en de andere waarden gelijk aan nul. Daardoor wordt onze te bekomen positie dus\begin{equation*} \frac{3000\cdot1000+4000\cdot1000}{1000+1000} = 3500.\end{equation*}

We definiëren nu de fout als de huidige positie min de te bekomen positie, 3500. Stel dat in de huidige positie de lijn rechts onder het wagentje ligt, dan zal volgens bovenstaande formule de huidige positie een grotere waarde aannemen dan 3500. De fout is dus positief en de wagen moet iets meer naar rechts rijden om dit te corrigeren. Daarom corrigeren we de linkse motorsnelheid met een plus $c \ \cdot$ fout, en de rechtse motorsnelheid met min $c \ \cdot$ fout, waarbij c een constante is die door testen bepaald wordt. 

Stel nu dat de lijn te links ligt, dan zal de huidige positie lager zijn dan 3500 en is de fout negatief. De linkse motor wordt gecorrigeerd met plus $c \  \cdot$ fout, maar de fout is negatief en resulteert dus in een netto negatieve correctie van de linkse motorsnelheid. De rechtse motorsnelheid zal dus een netto positieve correctie hebben. De wagen zal dus naar links rijden, wat precies is wat we wilden bereiken. \\ \\
\\
\textbf{\large De afstandssensor}\
\\
Onze microcontroller, een Raspberry Pi, kan enkel digitale output uitlezen. Daarom was het noodzakelijk om een analoog-digitaalomzetter (ADC) in de schakeling te verwerken. Deze communiceert met de microcontroller door middel van de `Serial Peripheral Interface' (SPI). Als we data van de sensor willen verkrijgen, sturen we een bericht naar de ADC, waarop deze ons een antwoord geeft. Dit antwoord is een digitaal antwoord bestaande uit twee bytes. 

Na 20 metingen van de lijnsensor werd de afstandssensor uitgelezen en werd er gecontroleerd of de afstand niet kleiner was dan 15 cm. Indien dit toch het geval was, stopte het wagentje met rijden en werd de afstandssensor continu uitgelezen. Indien de afstand groter werd dan 20 cm begon het robotwagentje terug te rijden. \\ \\
\\
\textbf{\large De kleurensensor}\
\\
Om de kleurensensor uit te lezen, maakten we gebruik van code geschreven door Adafruit zelf. We verhoogden de integratietijd naar 154 milliseconden en de versterking van de sensor met een factor zestien, zodat de sensor betere waarden geeft voor onze situatie met relatief weinig licht en zodat deze gevoeliger wordt. We bevestigen een papieren koker rond de sensor, zodat er minder verstoring door omgevingslicht kan plaatsvinden. De ruwe data van de sensor is een lijst van vier waarden: de roodwaarde, de groenwaarde, de blauwwaarde en de intensiteit. 

De data van de kleurensensor wordt enkel uitgelezen en geïnterpreteerd wanneer ons robotwagentje een stopstreep detecteert. We merkten bij het opnemen van de data dat de groenwaarde amper wijzigt wanneer de verkeerslichten veranderden, in tegenstelling tot de roodwaarde, die wel daalde bij een groen verkeerslicht. Daarom is de interpretatie van het verkeerslicht eerder `rood' en 'veel minder rood' dan `rood' of `groen'. We besloten ook om de data uit te filteren om meer representatieve waarden uit de meting te bekomen.

Wanneer het robotwagentje bij een stopstreep staat, worden er twee metingen voor roodwaarden gehouden van drie seconden elk. Onze keuze voor drie seconden was een compromis tussen voldoende roodwaarden bekomen en niet te lang wachten wanneer het al groen is. Op de twee metingen passen we dan een Fast Fourier transform toe, zodat de roodwaarden worden omgezet in `magnitudes' voor alle aanwezige frequenties in de meting. Uit elke meting halen we de magnitude voor de frequentie één Hertz, aangezien dit de frequentie is waarmee de verkeerslichten knipperen.

We bekomen dus twee waarden voor een periode van zes seconden wat veel gemakkelijker te vergelijken valt dan de ruwe data van de sensor zelf. We weten dat als het verschil tussen de eerste en de tweede magnitude groot genoeg en positief is, het licht is veranderd van rood naar groen. Ons robotwagentje mag dan het kruispunt op. Er is echter een probleem. De magnitude kan sterk variëren over de twee metingen indien het rood blijft, zoals te zien op figuur \ref{grafiek}, daarom voegden we een extra voorwaarde toe wanneer het verschil werd bekeken, namelijk dat de magnitude van de tweede meting laag genoeg moet zijn.

\begin{figure}[h]
	\centering
	\includegraphics[width=.8\textwidth] {magnitudes.PNG}
	\label{grafiek}
	\caption{De magnitude kan sterk verschillen over twee metingen.}
\end{figure}

Indien ons autootje stopt bij het kruispunt wanneer het licht al groen is, zal het verschil tussen de twee magnitudes niet groot genoeg zijn. Om enigszins te vermijden dat de robotwagen moet wachten totdat het licht van groen naar rood naar groen moet gaan, stellen we dat het waarschijnlijk groen is. Indien de magnitude van de tweede meting laag genoeg is, (zelfs nog wat lager dan bij de verandering van rood naar groen) zal het verkeerslicht ook groen zijn.\\ \\
\\
\textbf{\large Het nemen van een kruispunt} \
\\
Het nemen van een kruispunt hebben we als volgt geïmplementeerd. Er zijn drie mogelijkheden voor het nemen van een kruispunt: oversteken, rechts inslaan en links inslaan. De eenvoudigste optie is het oversteken. Wanneer het licht op groen springt, rijden we een aantal seconden vooruit, waarna we afwisselend even naar links en even naar rechts afwijken, om de kans dat het wagentje bij de volglijn terechtkomt te vergroten. Om rechts in te slaan rijden we opnieuw eerst een aantal seconden vooruit, waarna we ongeveer 90 graden naar rechts draaien, om dan rechtdoor te rijden tot op de volglijn. Het links inslaan gebeurt door eerst enkele seconden rechtdoor te rijden, dan ongeveer 60 à 70 graden naar links draaien en dan terug rechtdoor te rijden. De reden dat we niet zoals bij het rechts inslaan 90 graden draaien, is omdat we de kans om de lijn te vinden kunnen vergroten door lichtjes schuin in de richting van de volglijn te rijden.

	
\section{Evaluatie}

\subsection{Planning}
Tot en met week 5 is alles verlopen zoals gepland en vastgelegd in de Gantt-grafiek. De documenten met betrekking tot de planning zijn afgewerkt net zoals het ontwerp van het chassis en het CAD-model. Het bestellen van de onderdelen vond later plaats dan verwacht, vanwege de plaatsing bij de bieding. Dit heeft ons met een achterstand doen starten aan het programmeren en assembleren. Het team was van plan om te beginnen met de assemblage in week 6, echter werd dit een week uitgesteld vanwege een probleem met de microcontroller. Het programmeren van de sensoren verliep vlot, enkel het programmeren in verband met de aansturing van het wagentje nam meer tijd in dan ingerekend, namelijk twee weken. In het vervolg wordt best sneller om uitleg gevraagd wanneer iets herhaaldelijk niet werkt. Dit werd dan wel gecompenseerd door het maken van het CAD-model dat een week op voorhand klaar was, waardoor we nog altijd op schema zitten. Ook het schrijven van het verslag verloopt volgens schema. De feedback verwerken duurt langer dan voorspeld, maar is ruim op tijd gedaan. Het solderen had vroeger moeten ingepland worden, opdat dit grondiger kon gebeuren zonder tijdsdruk. De tijd voorzien tijdens de lessen wordt efficiënt gebruikt, waardoor het werk buiten de lessen wordt beperkt tot een minimum.

\begin{table}[h]
	\begin{tikzpicture}
		\begin{axis}[
			enlargelimits=0.10,
			ylabel={\# Kredietpunten}, % the ylabel must precede a # symbol. 
			symbolic x coords={Motor, Chassis, Sensoren, Makerbeams, Microcontroller, Powerbank},
			xtick=data,  
			nodes near coords, % this command is used to mention the y-axis points on the top of the particular bar.  
			nodes near coords align={vertical},  
			]  
			\addplot[ybar,fill=blue, bar width=30pt] coordinates {
				(Motor,   640)
				(Sensoren,  460)
				(Makerbeams,   115)
				(Chassis, 120)
				(Microcontroller, 240)
				(Powerbank, 180)
			};	
		\end{axis}
		
	\end{tikzpicture}
	
	\caption{De kost van de motoren is bijna 20\% van het volledige budget doordat een tweede paar motoren aangekocht moest worden. De tabel toont de absolute kosten van de grootste categorieën.}\label{fig:staafdiagram.credits}
\end{table}
\subsection{Financiën}

Omdat we de laatste keuze hadden bij het bestellen, liepen we achter op onze planning, onze financiële situatie kende hier dan weer voordelen door. We zijn gestart met een budget van 3500 kredietpunten, dat werd gereduceerd tot een tegoed van 1768 na het plaatsen van een eerste bestelling. In deze bestelling werden alle grote onderdelen en zaken die we zeker nodig hadden besteld.  Aan onze eerste levering ontbraken nog Maker Beams en afstandsbussen. Onze tweede bestelling kwam neer op 91 kredietpunten, waardoor we een budget van 1677 kredietpunten overhielden. Door de vele keuzemogelijkheden, waaronder vorm en dikte, werd ervoor gekozen het chassis zelf te ontwerpen en te 3D-printen. Dit was vermoedelijk een grote kost die werd geschat op 500 kredietpunten. Na het printen bleek het chassis slechts 120 kredietpunten te kosten. Samen met de kost voor de derde bestelling van 340 kredietpunten, bracht dit ons op een totaal van 1217 kredietpunten. Bij deze derde bestelling werden nieuwe 100:1 motoren gekocht na het vaststellen dat de 30:1 HP motoren niet genoeg koppel hadden. Dit zorgt ervoor dat de motoren de grootste kost van de wagen zijn. Onze financiële toestand zorgt ervoor dat we in een comfortabele situatie zitten en kunnen we het ons veroorloven om fouten te maken en risico's te nemen. De kosten van de belangrijkste onderdelen zijn terug te vinden in tabel \ref{fig:staafdiagram.credits}.


\subsection{De Demo}
Door de goede voorbereiding kon de demo probleemloos van start gaan. Het was duidelijk dat ons wagentje aanzienlijk trager was dan de andere, maar juist snel genoeg om andere wagens niet te hinderen op het parcours. Wanneer gestopt werd achter een voorligger, was dit relatief dicht. In het vervolg zal de minimumafstand voor de afstandssensor verhoogd moeten worden, zodat een goede afstand bewaard kan blijven. Bij het nemen van een kruispunt werd elke keer gestopt aan de stopstreep alvorens het kruispunt te betreden, echter werd af en toe een rood licht genegeerd. Het afslaan op een kruispunt verliep vlot, mits enkele manuele overnames. Ondanks de tweede rit minder vlot verliep dan de eerste, kan gezegd worden dat beide als een succes beschouwd mogen worden.  
\section{Besluit}


Met een budget van 3500 kredietpunten hebben we alle onderdelen kunnen aankopen om een naar behoren functionerende miniatuurwagen te bouwen. Van dit budget bleven 1217 kredietpunten over op het einde. Het initiële bedrag werd voornamelijk besteed aan wielen, motoren, een microcontroller, een powerbank, sensoren, een chassis en MakerBeam-onderdelen. Uit het financieel rapport bleek dat de motoren de grootste kost zijn en daarna de sensoren. 
Met dit robotwagentje hebben we, op enkele manuele overnames na, het parcours tweemaal succesvol en binnen de tijd kunnen beëindigen zonder andere wagens te hinderen. Tijdens de demo werd opgemerkt dat de linkermotor minder krachtig was dan de rechtermotor, dit zorgde echter niet voor grote problemen. 

Uit dit project concluderen we dat er veel mogelijkheden zijn om een miniatuurwagen te maken en dat er veel keuzes gemaakt moeten worden. Dit project toont op kleine schaal aan dat een smart city en meer specifiek, zelfrijdende wagens minder utopie en meer werkelijkheid worden. Zelfrijdende wagens kennen zeker een toekomst en hebben hun nut al meermaals bewezen. De weg naar een wereld met autonome wagens is lang, maar wordt stilaan meer en meer bereden. De concepten die werden toegepast in dit project hebben zeker ook andere doeleinden. Zo kan de volglijnsensor gebruikt worden om in de horeca klanten te bedienen. 
Indien we meer tijd hadden, zouden we een omhulsel printen voor de kleurensensor, in plaats van het papiertje dat nu gebruikt werd om het licht dat niet afkomstig was van het verkeerslicht te minimaliseren. Het zou ook een meerwaarde zijn geweest om ons wagentje te personaliseren met enkele stickers of vlaggen. 



	\bibliographystyle{plain} %De stijl van de bibliografie
	\bibliography{bibliografietv} %De bibliografie zelf

\begin{appendices}

\section{Gantt-grafiek en taakstructuur}
\includepdf[pages=-]{ganttchart.pdf}

\includepdf[pages=-]{taakstructuur.pdf}


\section{Budgetmanagement}
\begin{table}[h!]
	\centering
	
	\begin{tabular}{|l|r|r|r|}\hline
		
		\textbf{Onderdeel}&	\textbf{Aantal} &	\textbf{Prijs}	\\\hline
		Micro Metal Gear Motor 100:1 &	2 &320\\\hline
		Micro Metal Gear Motor 30:1 HP&		2	&320\\\hline
		Raspberry Pi&		1		&240\\\hline
		Powerbank&		1&180\\\hline
		Dual Drive DRV8833&		1 &70\\\hline
		Wiel 32x7 mm zwart&		2&70\\\hline
		Ball Caster&		1 &60\\\hline
		Optische afstandsensor (analoog)&		1	&160\\\hline
		TCS34725 Kleur sensor BOB &		1 &15 \\\hline
		QTR-8RC digitale reflectie sensor array &		1	&150\\\hline
		MakerBeam Hoekverbinding 90°&		2	&15\\\hline
		MakerBeam profiel 40 mm&		1 &20\\\hline
		MakerBeam profiel 60 mm&		3 	&60\\\hline
		MakerBeam profiel 100 mm&		1	&20\\\hline
		Micro metal gear motor beugel&		2 &50\\\hline
		Breadboard Tiny&		2	&80\\\hline
		ADC MCP3002-I/P&		1 &40\\\hline
		Motorschield IC&		1&	70\\\hline
		Wire to board socket&		4	&20\\\hline
		Printplaat&		1	&50\\\hline
		Male headers 10&		3&15 \\\hline
		Afstandsbus 15x5 mm nylon&		2 &1\\\hline
		Afstandsbus 20x5 mm nylon&		4 &2\\\hline
		
	\end{tabular}
\end{table}


\section{Circuit diagram}
\includepdf[pages=-]{circuit_diagram.pdf}

\section{Peerreview}

\large Nagelezen door... \

\begin{itemize}
	\item Rani Jans, team 6
	\item Romeo Bostoen, team 10
	\item Simon Desimpelaere, team 8
	\item Emile Moeyaert, team 7
	\item Mattias Vermeersch, team 5
	\item Jotte Decavel, team 9
\end{itemize}



\end{appendices}




\end{document}